%% do not format this file
%% the strings need to be in the first column

{
"",
    [],
    {
        [],
        []
    }
}.

{
"%123
2.",
    [],
    {
        [],
        []
    }
}.

{
"%123
%    456
-define(X,X+X).",
    [
        {define,'X',-1,none,
            [{var,{2,11},"X",'X'},{var,{2,13},"X",'X'}],
            [<<"123">>, <<"    456">>],
            {{2,9},{2,10}},
            {{2,1},{2,15}}}
    ],
    {
        [
            {[{macro,'X',-1}],{{2,9},{2,10}}, {{2,1},{2,15}}, #{comments=>[<<"123">>, <<"    456">>]}},
            {[{macro,'X',-1},{var,'X'}],{{2,11},{2,12}}, none, #{}}
        ],
        [
            %TODO {[{macro,'X',-1},{var,'X'}],{{2,11},{2,12}}},
            {[{macro,'X',-1},{var,'X'}],{{2,13},{2,14}}}
        ]
    }
}.

{
"%123
-define(Z(A,BB),A).",
    [
        {define,'Z',2,
                [[{var,{1,11},"A",'A'}],[{var,{1,13},"BB",'BB'}]],
                [{var,{1,17},"A",'A'}],
                [<<"123">>],
                {{1,9},{1,10}},
                {{1,1},{1,19}}}
    ],
    {
        [
            {[{macro,'Z',2}],{{1,9},{1,10}},{{1,1},{1,19}},#{comments=>[<<"123">>]}},
            {[{macro,'Z',2},{var,'A'}],{{1,11},{1,12}},none,#{}},
            {[{macro,'Z',2},{var,'BB'}],{{1,13},{1,15}},none,#{}}
        ],
        [
            {[{macro,'Z',2},{var,'A'}],{{1,17},{1,18}}}
        ]
    }
}.

{
"%123
-include_lib(\"file\").",
    [
        {include_lib,"file",[<<"123">>],{{1,14},{1,20}}}
    ],
    {
        [],
        [{[{include_lib, "file"}], {{1,14},{1,20}}}]
    }
}.

{
"%123
-include(\"file\").",
    [
        {include,"file",[<<"123">>],{{1,10},{1,16}}}
    ],
    {
        [],
        [{[{include, "file"}], {{1,10},{1,16}}}]
    }
}.

{
"%123
-compile(fob).",
    [
        {compile,{1,2},[{atom,{1,10},"fob",fob}],[<<"123">>]}
    ],
    {
        [],
        []
    }
}.

{
"%123
-module(x).",
    [{module,x,[<<"123">>],{{1,9},{1,10}}}],
    {
        [
            {[{module,x}],{{1,9},{1,10}},none,#{comments=>[<<"123">>]}}
        ],
        []
    }
}.

{
"%123
-import(mmm, [a/1,b/2]).",
    [
        {import,mmm,
                [{a,1,{{1,15},{1,18}}},{b,2,{{1,19},{1,22}}}],
                [<<"123">>]}
    ],
    {
        [],
        [
            {[{module,mmm},{function,a,1}], {{1,15},{1,18}}},
            {[{module,mmm},{function,b,2}], {{1,19},{1,22}}}
        ]
    }
}.

{
"%123
-export_type([a/1,b/2]).",
    [
        {export_type,
                [{a,1,{{1,15},{1,18}}},{b,2,{{1,19},{1,22}}}],
                [<<"123">>]}
    ],
    {
        [],
        [
            {[{type,a,1}],{{1,15},{1,18}}},
            {[{type,b,2}],{{1,19},{1,22}}}
        ]
    }
}.

{
"%123
-export([a/1,b/2]).",
    [
        {export,
                [{a,1,{{1,10},{1,13}}},{b,2,{{1,14},{1,17}}}],
                [<<"123">>]}
    ],
    {
        [],
        [
            {[{function,a,1}],{{1,10},{1,13}}},
            {[{function,b,2}],{{1,14},{1,17}}}
        ]
    }
}.

{
"%123
-callback bar(X)->'ok'|[Y].",
    [
        {callback,bar,1,
            [{[[{var,{1,15},"X",'X'}]],
                [{var,{1,25},"Y",'Y'}]}],
            [<<"123">>],
            {{1,11},{1,14}},
            {{1,1},{1,27}}}
    ],
    {
        [],
        []
    }
}.

{
"%123
-spec foo(X :: integer(), Y) -> string(); (Z)->'ok'.",
    [
        {spec,foo,2,
            [{[[{var,{1,11},"X",'X'},
                {call,{atom,{1,16},"integer",integer},[]}],
                [{var,{1,27},"Y",'Y'}]],
                [{call,{atom,{1,33},"string",string},[]}]},
                {[[{var,{1,44},"Z",'Z'}]],[]}],
            [<<"123">>],
            {{1,7},{1,10}},
            {{1,1},{1,52}}}
    ],
    {
        [],
        [{[{function,foo,2}],{{1,7},{1,10}}}]
    }
}.

{
"%123
-opaque foo():: integer().",
    [
        {type,foo,0,[],
                [{call,{atom,{1,17},"integer",integer},[]}],
                [<<"123">>],
                {{1,9},{1,12}},
                {{1,1},{1,26}}}
    ],
    {
        [
            {[{type,foo,0}],{{1,9},{1,12}},{{1,1},{1,26}},#{comments=>[<<"123">>]}}
        ],
        [
        ]
    }
}.

{
"%123
-type foo():: my_integer().",
    [
        {type,foo,0,[],
                [{call,{atom,{1,15},"my_integer",my_integer},[]}],
                [<<"123">>],
                {{1,7},{1,10}},
                {{1,1},{1,27}}}
    ],
    {
        [
            {[{type,foo,0}],{{1,7},{1,10}},{{1,1},{1,27}},#{comments=>[<<"123">>]}}
        ],
        [
            {[{type,my_integer,0}],{{1,15},{1,25}}}
        ]
    }
}.

{
"%123
-type(foo():: #arec{}).",
    [
        {type,foo,0,[],
                [{record,{atom,{1,16},"arec",arec},[]}],
                [<<"123">>],
                {{1,7},{1,10}},
                {{1,1},{1,23}}}
    ],
    {
        [
            {[{type,foo,0}],
                {{1,7},{1,10}},
                {{1,1},{1,23}},
                #{comments => [<<"123">>]}}
        ],
        [
            {[{record,arec}],{{1,16},{1,20}}}
        ]
    }
}.

{
"%123
-record(r,{a::string(),b,c=0,d::[x:baz()]=3}).",
    [
        {record,r,
            [<<"123">>],
            {{1,9},{1,10}},
            [{field,{{1,12},{1,13}},
                    a,
                    [{call,{atom,{1,15},"string",string},[]}],
                    []},
            {field,{{1,24},{1,25}},b,[],[]},
            {field,{{1,26},{1,27}},c,[],[]},
            {field,{{1,30},{1,31}},
                    d,
                    [{call,{atom,{1,34},"x",x},{atom,{1,36},"baz",baz},[]}],
                    []}],
            {{1,1},{1,46}}}
    ],
    {
        [
            {[{record,r}],{{1,9},{1,10}},{{1,1},{1,46}},#{comments=>[<<"123">>]}},
            {[{record,r},{field,a}],{{1,12},{1,13}},none,#{}},
            {[{record,r},{field,b}],{{1,24},{1,25}},none,#{}},
            {[{record,r},{field,c}],{{1,26},{1,27}},none,#{}},
            {[{record,r},{field,d}],{{1,30},{1,31}},none,#{}}
        ],
        [
            {[{module,x},{type,baz,0}],{{1,36},{1,39}}}
        ]
    }
}.

{
"%123
-foo(X, Y).",
    [
        {attribute,foo,
                    [{var,{1,6},"X",'X'},
                    {',',{1,7},",",undefined},
                    {var,{1,9},"Y",'Y'}],
                    [<<"123">>]}
    ],
    {
        [],
        []
    }
}.

{
"%123
foo(1,[2,3]) -> ok.",
    [
        {function,foo,2,
            [{clause,1,
                        [[],[]],
                        [],[]}],
            [<<"123">>],
            {{1,1},{1,4}},
            {{1,1},{1,19}}}
    ],
    {
        [
            {[{function,foo,2}],{{1,1},{1,4}},{{1,1},{1,19}},#{comments=>[<<"123">>]}}
        ],
        []
    }
}.

{
"%123
foo(Xx) when Xx==0 -> Xx.",
    [
        {function,foo,1,
                [{clause,1,
                    [[{var,{1,5},"Xx",'Xx'}]],
                    [{var,{1,14},"Xx",'Xx'}],
                    [{var,{1,23},"Xx",'Xx'}]}],
                [<<"123">>],
                {{1,1},{1,4}},
                {{1,1},{1,25}}}
    ],
    {
        [
            {[{function,foo,1},{clause,1},{var,'Xx'}],{{1,5},{1,7}},none,#{}},
            {[{function,foo,1}],{{1,1},{1,4}},{{1,1},{1,25}},#{comments=>[<<"123">>]}}
        ],
        [
            {[{function,foo,1},{clause,1},{var,'Xx'}],{{1,14},{1,16}}},
            {[{function,foo,1},{clause,1},{var,'Xx'}],{{1,23},{1,25}}}
        ]
    }
}.

{
"%%hello
foo() -> ok.",
    [
        {function,foo,0,
            [{clause,1,[],[],[]}],
            [<<"hello">>],
            {{1,1},{1,4}},
            {{1,1},{1,12}}}
    ],
    {
        [
            {[{function,foo,0}],{{1,1},{1,4}},{{1,1},{1,12}},#{comments=>[<<"hello">>]}}
        ],
        []
    }
}.

{
"%123
foo(A,[2,3]) -> A, ok1;
foo(A,b) -> A, ok2.",
    [
        {function,foo,2,
            [{clause,1,
                        [[{var,{1,5},"A",'A'}],[]],
                        [],
                        [{var,{1,17},"A",'A'}]},
                {clause,2,
                        [[{var,{2,5},"A",'A'}],
                        []],
                        [],
                        [{var,{2,13},"A",'A'}]}],
            [<<"123">>],
            {{1,1},{1,4}},
            {{1,1},{2,19}}}
    ],
    {
        [
            {[{function,foo,2}],{{1,1},{1,4}},{{1,1},{2,19}},#{comments=>[<<"123">>]}},
            {[{function,foo,2},{clause,1},{var,'A'}],{{1,5},{1,6}},none,#{}},
            {[{function,foo,2},{clause,2},{var,'A'}],{{2,5},{2,6}},none,#{}}
        ],
        [
            {[{function,foo,2},{clause,1},{var,'A'}],{{1,17},{1,18}}},
            {[{function,foo,2},{clause,2},{var,'A'}],{{2,13},{2,14}}}
        ]
    }
}.

{
"%hello
-module(mx).
%baz
foo() -> ok.",
    [
        {module,mx,[<<"hello">>],{{1,9},{1,11}}},
        {function,foo,0,
                [{clause,1,[],[],[]}],
                [<<"baz">>],
                {{3,1},{3,4}},
                {{3,1},{3,12}}}
    ],
    {
        [
            {[{module,mx}],{{1,9},{1,11}},none,#{comments=>[<<"hello">>]}},
            {[{function,foo,0}],{{3,1},{3,4}},{{3,1},{3,12}},#{comments=>[<<"baz">>]}}
        ],
        []
    }
}.

{
"-define(A, true).
-define(A(), false).
-define(A, false).
foo() -> ?A, ?A(), ?A(?X,X).
",
    [
        {define,'A',-1,none,[],[],{{0,9},{0,10}},{{0,1},{0,17}}},
        {define,'A',0,[],[],[],{{1,9},{1,10}},{{1,1},{1,20}}},
        {define,'A',-1,none,[],[],{{2,9},{2,10}},{{2,1},{2,18}}},
        {function,foo,0,
            [{clause,1,[],[],
                [
                    {macro,{3,10},"?A",none},
                    {macro,{3,14},"?A",[]},
                    {macro,
                        {3,20},
                        "?A",
                        [[{macro,{3,23},"?X",none}],
                            [{var,{3,26},"X",'X'}]]}]}],
            [],
            {{3,1},{3,4}},
            {{3,1},{3,28}}}
    ],
    {
        [
            {[{function,foo,0}],{{3,1},{3,4}},{{3,1},{3,28}},#{}},
            {[{macro,'A',-1}],{{0,9},{0,10}},{{0,1},{0,17}},#{}},
            {[{macro,'A',-1}],{{2,9},{2,10}},{{2,1},{2,18}},#{}},
            {[{macro,'A',0}],{{1,9},{1,10}},{{1,1},{1,20}},#{}}
        ],
        [
            {[{macro,'A',-1}],{{3,10},{3,12}}},
            {[{macro,'A',0}],{{3,14},{3,16}}},
            {[{macro,'A',2}],{{3,20},{3,22}}}
        ]
    }
}.

{
"bar([a,X]) ->
fun m:f/3,
b(?z,3),
d:g(?Z),
?MODULE:g(),
#rr.ff,
#fg{gf=g(Y)},
fun(A)->X;(B)->Y end,
Qok;
bar(_+1)-> ok.

quux()->ok.
-type foo(X) :: bar().
",
    [
        {function,bar,1,
            [{clause,1,
                [[{var,{0,8},"X",'X'}]],
                [],
                [
                    {funref,
                        {atom,{1,5},"m",m},
                        {atom,{1,7},"f",f},
                        {integer,{1,9},"3",3}},
                    {call,{atom,{2,1},"b",b},[[{macro,{2,3},"?z",none}],[]]},
                    {call,
                        {atom,{3,1},"d",d},
                        {atom,{3,3},"g",g},
                        [[{macro,{3,5},"?Z",none}]]},
                    {call,
                        {macro,{4,1},"?MODULE",'?MODULE'},
                        {atom,{4,9},"g",g},
                        []},
                    {recfield,{atom,{5,2},"rr",rr},{atom,{5,5},"ff",ff}},
                    {record,
                        {atom,{6,2},"fg",fg},
                        [{{atom,{6,5},"gf",gf},
                            [{call,
                            {atom,{6,8},"g",g},
                            [[{var,{6,10},"Y",'Y'}]]}]}]},
                    {defun,'',1,1,
                            [{clause,1,
                            [[{var,{7,5},"A",'A'}]],
                            [],
                            [{var,{7,9},"X",'X'}]},
                            {clause,2,
                            [[{var,{7,12},"B",'B'}]],
                            [],
                            [{var,{7,16},"Y",'Y'}]}],
                        {{7,4},{7,5}}},
                    {var,{8,1},"Qok",'Qok'}]},
            {clause,2,[[]],[],[]}],
            [],
            {{0,1},{0,4}},
            {{0,1},{9,14}}},
        {function,quux,0,[{clause,1,[],[],[]}],[],{{11,1},{11,5}},{{11,1},{11,11}}},
        {type,foo,1,
            [[{var,{12,11},"X",'X'}]],
            [{call,{atom,{12,17},"bar",bar},[]}],
            [],
            {{12,7},{12,10}},
            {{12,1},{12,22}}}
    ],
    {
        [   %todo,
            {[{function,bar,1}],{{0,1},{0,4}},{{0,1},{9,14}},#{}},
            {[{function,bar,1},{clause,1},{var,'Qok'}],{{8,1},{8,4}},none,#{}},
            {[{function,bar,1},{clause,1},{var,'X'}],{{0,8},{0,9}},none,#{}},
            {[{function,quux,0}],{{11,1},{11,5}},{{11,1},{11,11}},#{}},
            {[{type,foo,1}],{{12,7},{12,10}},{{12,1},{12,22}},#{}},
            {[{type,foo,1},{var,'X'}],{{12,11},{12,12}},none,#{}}],
        [
            {[{record,fg}],{{6,2},{6,4}}},
            {[{function,bar,1},{clause,1},{function,b,2}],{{2,1},{2,2}}},
            {[{type,bar,0}],{{12,17},{12,20}}}
        ]
    }
}.

{
"-type f1() :: fun().
-type f2() :: fun((...)->X).
-type f3(fun()) :: fun(() -> X).
-type f4() :: fun((Y)->X).
",
    [
        {type,f1,0,[],
            [{defun,'',0,1,
                    [{clause,1,[],[],[]}],
                    {{0,18},{0,19}}}],
            [],
            {{0,7},{0,9}},
            {{0,1},{0,20}}},
        {type,f2,0,[],
            [{defun,'',1,1,
                    [{clause,1,[[{var,{1,26},"X",'X'}]],[],[]}],
                    {{1,18},{1,19}}}],
            [],
            {{1,7},{1,9}},
            {{1,1},{1,28}}},
        {type,f3,1,
            [[{defun,'',0,1,
                    [{clause,1,[],[],[]}],
                    {{2,13},{2,14}}}]],
            [{defun,'',1,1,
                    [{clause,1,[[{var,{2,30},"X",'X'}]],[],[]}],
                    {{2,23},{2,24}}}],
            [],
            {{2,7},{2,9}},
            {{2,1},{2,32}}},
        {type,f4,0,[],
            [{defun,'',1,1,
                    [{clause,1,
                        [[{var,{3,20},"Y",'Y'},
                            {var,{3,24},"X",'X'}]],
                        [],[]}],
                    {{3,18},{3,19}}}],
            [],
            {{3,7},{3,9}},
            {{3,1},{3,26}}}
    ],
    {
        [
            {[{type,f1,0}],{{0,7},{0,9}},{{0,1},{0,20}},#{}},
            {[{type,f2,0}],{{1,7},{1,9}},{{1,1},{1,28}},#{}},
            {[{type,f3,1}],{{2,7},{2,9}},{{2,1},{2,32}},#{}},
            {[{type,f4,0}],{{3,7},{3,9}},{{3,1},{3,26}},#{}}
        ],
        [
            %todo
        ]
    }
}.